<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calcul depuis image (Gratuit)</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background-color: #f0f0f0; }
  h1 { color: #333; }
  input, button { margin-top: 10px; padding: 10px; font-size: 16px; }
  #result { margin-top: 20px; font-weight: bold; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>Calcul depuis une image</h1>
<input type="file" id="fileInput" accept="image/*">
<button onclick="analyzeImage()">Analyser et Calculer</button>

<div id="result"></div>

<script>
function sanitizeExpression(expr) {
    // Garde uniquement les chiffres, + - * / et parenthèses
    return expr.replace(/[^0-9+\-*/().]/g, '');
}

async function analyzeImage() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    const resultDiv = document.getElementById('result');

    if (!file) {
        alert("Veuillez sélectionner une image !");
        return;
    }

    resultDiv.textContent = "Analyse en cours... (cela peut prendre quelques secondes)";

    // Utiliser Tesseract.js pour l'OCR
    const { createWorker } = Tesseract;
    const worker = createWorker({
        logger: m => console.log(m) // Affiche la progression dans la console
    });

    await worker.load();
    await worker.loadLanguage('fra');
    await worker.initialize('fra');

    const { data: { text } } = await worker.recognize(file);
    await worker.terminate();

    resultDiv.textContent = "Texte détecté :\n" + text;

    // Cherche des expressions mathématiques simples
    const sanitized = sanitizeExpression(text);

    if (sanitized) {
        try {
            const value = eval(sanitized);
            resultDiv.textContent += "\n\nExpression calculable : " + sanitized;
            resultDiv.textContent += "\nRésultat : " + value;
        } catch {
            resultDiv.textContent += "\n\nImpossible de calculer automatiquement cette expression.";
        }
    } else {
        resultDiv.textContent += "\n\nAucune expression mathématique détectée.";
    }
}
</script>

</body>
</html>
